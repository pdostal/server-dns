{% set hostnames = [] %}
{% for item in groups.slave %}
{% do hostnames.append(hostvars[item].inventory_hostname+"4") %}
{% do hostnames.append(hostvars[item].inventory_hostname+"6") %}
{% endfor %}
system {
  version on;
  identity on;
  user knot.knot;
}

control {
  listen-on "knot.sock";
}

log {
  syslog { any info; }
  stderr { any warning; }
}

interfaces {
  all_ipv4 { address 0.0.0.0; port 53; }
  all_ipv6 { address [::]; port 53; }
}

remotes {
{% for item in groups.slave %}
  {{ hostvars[item].inventory_hostname }}4 {
    address {{ hostvars[item].ansible_default_ipv4.address }}@53;
    via {{ ansible_default_ipv4.address }};
  }

  {{ hostvars[item].inventory_hostname }}6 {
    address {{ hostvars[item].ansible_default_ipv6.address }}@53;
    via {{ ansible_default_ipv6.address }};
  }

{% endfor %}
}

zones {
  storage "/etc/knot/zones";

  dnssec-enable on;
  dnssec-keydir "/etc/knot/keys";
  signature-lifetime 15d;

  pdostal.cz {
    file "pdostal.cz";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

  blindtroll.com {
    file "blindtroll.com";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

  maserservis.cz {
    file "maserservis.cz";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

  motorenovace.com {
    file "motorenovace.com";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

  truhlarstvitaticek.cz {
    file "truhlarstvitaticek.cz";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

}
