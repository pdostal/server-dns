{% set hostnames = [] %}
{% for item in groups.master %}
{% do hostnames.append(hostvars[item].inventory_hostname+"4") %}
{% do hostnames.append(hostvars[item].inventory_hostname+"6") %}
{% endfor %}
system {
  version on;
  identity on;
  user knot.knot;
}

control {
  listen-on "knot.sock";
}

log {
  syslog { any info; }
  stderr { any warning; }
}

interfaces {
  all_ipv4 { address 0.0.0.0; port 53; }
  all_ipv6 { address [::]; port 53; }
}

remotes {
{% for item in groups.master %}
  {{ hostvars[item].inventory_hostname }}4 { address {{ hostvars[item].ansible_default_ipv4.address }}@53; via {{ ansible_default_ipv4.address }}; }
  {{ hostvars[item].inventory_hostname }}6 { address {{ hostvars[item].ansible_default_ipv6.address }}@53; via {{ ansible_default_ipv6.address }}; }
{% endfor %}
}

zones {
  storage "/etc/knot/zones";

  pdostal.cz {
    file "pdostal.cz";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  maserservis.cz {
    file "maserservis.cz";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  motorenovace.com {
    file "motorenovace.com";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  truhlarstvitaticek.cz {
    file "truhlarstvitaticek.cz";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

}
