system {
  version on;
  user knot.knot;
}

control {
  listen-on "knot.sock";
}

log {
  syslog { any info; }
}

interfaces {
  net6 { address [{{ ipv6 }}]@53; }
  net4 { address {{ ipv4 }}@53; }
}

remotes {
{% for item in groups.master %}
  {{ hostvars[item].inventory_hostname }}6 {
    address [{{ hostvars[item].ipv6 }}]@53;
    via {{ ipv6 }};
  }
  {{ hostvars[item].inventory_hostname }}4 {
    address {{ hostvars[item].ipv4 }}@53;
    via {{ ipv4 }};
  }
{% endfor %}
}

zones {
  storage "{{ knot_conf }}data";

  {% set hostnames = [] %}
  {% for item in groups.master %}
  {% do hostnames.append(hostvars[item].inventory_hostname+"6") %}
  {% do hostnames.append(hostvars[item].inventory_hostname+"4") %}
  {% endfor %}

  pdostal.cz {
    file "{{ knot_conf }}zones/pdostal.cz";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  motorenovace.com {
    file "{{ knot_conf }}zones/motorenovace.com";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  truhlarstvitaticek.cz {
    file "{{ knot_conf }}zones/truhlarstvitaticek.cz";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  27.27.172.in-addr.arpa {
    file "{{ knot_conf }}zones/27.27.172.in-addr.arpa";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  26.26.172.in-addr.arpa {
    file "{{ knot_conf }}zones/26.26.172.in-addr.arpa";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  24.24.172.in-addr.arpa {
    file "{{ knot_conf }}zones/24.24.172.in-addr.arpa";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  29.29.172.in-addr.arpa {
    file "{{ knot_conf }}zones/29.29.172.in-addr.arpa";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

  31.31.172.in-addr.arpa {
    file "{{ knot_conf }}zones/31.31.172.in-addr.arpa";
    notify-in {{ hostnames|join(", ") }};
    xfr-in {{ hostnames|join(", ") }};
  }

}
