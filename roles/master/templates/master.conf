server:
  listen: {{ ipv6 }}@53
  listen: {{ ipv4 }}@53
  listen: 172.22.149.116@53
  user: knot:knot

log:
- target: syslog
  any: info


template:
- id: default
  dnssec-signing: on
  kasp-db: kasp
  storage: /usr/local/etc/knot/data


remote:
{% for item in groups.slave %}
- id: {{ hostvars[item].inventory_hostname }}6
  via: {{ ipv6 }}
  address: {{ hostvars[item].ipv6 }}@53
- id: {{ hostvars[item].inventory_hostname }}4
  via: {{ ipv4 }}
  address: {{ hostvars[item].ipv4 }}@53

{% endfor %}

acl:
{% for item in groups.slave %}
- id: acl_{{ hostvars[item].inventory_hostname }}6
  address: {{ hostvars[item].ipv6 }}
  action: transfer
- id: acl_{{ hostvars[item].inventory_hostname }}4
  address: {{ hostvars[item].ipv4 }}
  action: transfer

{% endfor %}

{% set hostnames = [] %}
{% set aclhostnames = [] %}
{% for item in groups.slave %}
{% do hostnames.append(hostvars[item].inventory_hostname+"6") %}
{% do hostnames.append(hostvars[item].inventory_hostname+"4") %}
{% do aclhostnames.append("acl_"+hostvars[item].inventory_hostname+"6") %}
{% do aclhostnames.append("acl_"+hostvars[item].inventory_hostname+"4") %}
{% endfor %}

zone:
- domain: pdostal.cz
  file: {{ knot_conf }}zones/pdostal.cz
  acl: [ {{ aclhostnames|join(", ") }} ]
  notify: [ {{ hostnames|join(", ") }} ]

- domain: pdostal.dn42
  file: {{ knot_conf }}zones/pdostal.dn42
  acl: [ {{ aclhostnames|join(", ") }} ]
  notify: [ {{ hostnames|join(", ") }} ]
  dnssec-signing: off

- domain: motorenovace.com
  file: {{ knot_conf }}zones/motorenovace.com
  acl: [ {{ aclhostnames|join(", ") }} ]
  notify: [ {{ hostnames|join(", ") }} ]

- domain: 149.22.172.in-addr.arpa
  file: {{ knot_conf }}zones/149.22.172.in-addr.arpa
  acl: [ {{ aclhostnames|join(", ") }} ]
  notify: [ {{ hostnames|join(", ") }} ]
  dnssec-signing: off

- domain: 27.27.172.in-addr.arpa
  file: {{ knot_conf }}zones/27.27.172.in-addr.arpa
  acl: [ {{ aclhostnames|join(", ") }} ]
  notify: [ {{ hostnames|join(", ") }} ]
  dnssec-signing: off

- domain: 26.26.172.in-addr.arpa
  file: {{ knot_conf }}zones/26.26.172.in-addr.arpa
  acl: [ {{ aclhostnames|join(", ") }} ]
  notify: [ {{ hostnames|join(", ") }} ]
  dnssec-signing: off
