system {
  version on;
  user knot.knot;
}

control {
  listen-on "knot.sock";
}

log {
  syslog { any info, error, warning; }
}

interfaces {
  net6 { address [{{ ipv6 }}]@53; }
  net4 { address {{ ipv4 }}@53; }
}

remotes {
{% for item in groups.slave %}
  {{ hostvars[item].inventory_hostname }}6 {
    address [{{ hostvars[item].ipv6 }}]@53;
    via [{{ ipv6 }}];
  }
  {{ hostvars[item].inventory_hostname }}4 {
    address {{ hostvars[item].ipv4 }}@53;
    via {{ ipv4 }};
  }
{% endfor %}
}

zones {
  storage "{{ knot_conf }}zones";

  dnssec-enable on;
  dnssec-keydir "{{ knot_conf }}keys";
  signature-lifetime 15d;

  {% set hostnames = [] %}
  {% for item in groups.slave %}
  {% do hostnames.append(hostvars[item].inventory_hostname+"6") %}
  {% do hostnames.append(hostvars[item].inventory_hostname+"4") %}
  {% endfor %}

  pdostal.cz {
    file "pdostal.cz";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

  maserservis.cz {
    file "maserservis.cz";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

  motorenovace.com {
    file "motorenovace.com";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

  truhlarstvitaticek.cz {
    file "truhlarstvitaticek.cz";
    notify-out {{ hostnames|join(", ") }};
    xfr-out {{ hostnames|join(", ") }};
  }

}
