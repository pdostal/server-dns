- set_fact:
    knot_conf: /usr/local/etc/knot/
  when: ansible_distribution == 'FreeBSD'
- set_fact:
    knot_conf: /etc/knot/
  when: ansible_system == 'Linux'

- name: Install KnotDNS (Debian)
  when: ansible_distribution == 'Debian'
  apt: name=knot,knot-host,knot-dnsutils state=latest force=yes
- name: Install KnotDNS (CentOS)
  when: ansible_distribution == 'CentOS'
  yum: name=knot state=latest
- name: Install KnotDNS (FreeBSD)
  when: ansible_distribution == 'FreeBSD'
  pkgng: name=knot state=present
- name: Enable KnotDNS (FreeBSD)
  when: ansible_distribution == 'FreeBSD'
  lineinfile: dest=/etc/rc.conf regexp=^knot_enable= line=knot_enable=YES
- name: Enable KnotDNS (FreeBSD)
  when: ansible_distribution == 'FreeBSD'
  lineinfile: dest=/etc/rc.conf regexp=^knot_config= line=knot_config=/usr/local/etc/knot/knot.conf

- name: Creates zones/ directory
  file: >
    path={{ knot_conf }}zones
    state=directory
    owner=knot
    group=knot
    mode=0770
  notify: restart service

- name: Creates data/ directory
  file: >
    path={{ knot_conf }}data
    state=directory
    owner=knot
    group=knot
    mode=0770
  notify: restart service

- name: Paste master config
  template: >
    src=master.conf
    dest={{ knot_conf }}knot.conf
    owner=knot
    group=knot
    mode=0640
  notify: restart service

- name: Clone zones repository
  git: repo=https://github.com/pdostal/server-zones.git dest={{ knot_conf }}data
  notify: reload service
- name: Set permissions for data/ folder
  file: >
    state=directory
    path={{ knot_conf }}data
    owner=knot
    group=knot
    mode=0640
  notify: reload service
