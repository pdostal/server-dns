- set_fact:
    knot_conf: /usr/local/etc/knot/
  when: ansible_distribution == 'FreeBSD'
- set_fact:
    knot_conf: /etc/knot/
  when: ansible_system == 'Linux'

- name: Install KnotDNS (Debian)
  when: ansible_distribution == 'Debian'
  apt: name=knot,knot-host,knot-dnsutils state=latest force=yes
- name: Install KnotDNS (CentOS)
  when: ansible_distribution == 'CentOS'
  yum: name=knot state=latest
- name: Install KnotDNS (FreeBSD)
  when: ansible_distribution == 'FreeBSD'
  pkgng: name=knot2-2.0.1 state=present
- name: Enable KnotDNS (FreeBSD)
  when: ansible_distribution == 'FreeBSD'
  lineinfile: dest=/etc/rc.conf regexp=^knot_enable= line=knot_enable=YES
- name: Enable KnotDNS (FreeBSD)
  when: ansible_distribution == 'FreeBSD'
  lineinfile: dest=/etc/rc.conf regexp=^knot_config= line=knot_config=/usr/local/etc/knot/knot.conf

- name: Creates data/ directory
  file: >
    path={{ knot_conf }}data
    state=directory
    recurse=yes
    owner=knot
    group=knot
    mode=0774
  notify: restart knot

- name: Creates kasp/ directory
  file: >
    path={{ knot_conf }}data/kasp
    state=directory
    recurse=yes
    owner=knot
    group=knot
    mode=0770
  notify: restart knot

- name: Clone zones repository
  git: >
    repo=https://github.com/pdostal/server-zones.git
    dest={{ knot_conf }}zones
  notify: reload knot
- name: Set permissions for data/ folder
  file: >
    state=directory
    path={{ knot_conf }}zones
    recurse=yes
    owner=knot
    group=knot
    mode=0774
  notify: reload knot

- name: Paste master config
  template: >
    src=master.conf
    dest={{ knot_conf }}knot.conf
    owner=knot
    group=knot
    mode=0640
  notify: restart knot
